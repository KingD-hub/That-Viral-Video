<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DailyClips - Hot Videos</title>
    <link rel="stylesheet" href="assets/styles.css">
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- Popunder Ad -->
    <script type='text/javascript' src='//pl27466028.profitableratecpm.com/1c/ec/ba/1cecba33959a73dc0225a98248e1e330.js'></script>
    
    <!-- Social Bar Ad -->
    <script type='text/javascript' src='//pl27495784.profitableratecpm.com/b0/db/62/b0db62ad1f1a1d4102ccae80a8ecdf4a.js'></script>
</head>
<body>
    <header>
        <h1>DailyClips</h1>
        <p>Hot videos updated daily</p>
        <div style="margin-top: 10px;">
            <a href="admin/" style="color: #ff6b6b; text-decoration: none; font-size: 14px; padding: 5px 10px; border: 1px solid #ff6b6b; border-radius: 5px;">ðŸ”§ Admin Panel</a>
    </div>
  </header>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" class="search-box" id="searchBox" placeholder="Search videos..." onkeyup="searchVideos()">
    </div>

    <main>
        <div class="video-grid" id="videoGrid">
            <!-- Videos will be loaded dynamically from CMS -->
            <div class="loading">Loading videos...</div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <span class="current">1</span>
            <a href="page2.html">2</a>
            <a href="page3.html">3</a>
            <a href="page4.html">4</a>
            <a href="page5.html">5</a>
            <a href="page2.html">Next â†’</a>
        </div>

        <!-- Banner Ad -->
    <div class="banner-slot">
            <script type="text/javascript">
                atOptions = {
                    'key' : '8222901a4a0a0abca1bf6e66669f066d',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/8222901a4a0a0abca1bf6e66669f066d/invoke.js"></script>
    </div>
  </main>

    <footer>
        <p>&copy; 2024 DailyClips. All rights reserved.</p>
        <a href="legal.html">Legal</a>
  </footer>

  <script>
        // Search functionality
        function searchVideos() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const videoCards = document.querySelectorAll('.video-card');
            
            videoCards.forEach(card => {
                const title = card.getAttribute('data-title').toLowerCase();
                const description = card.getAttribute('data-description').toLowerCase();
                const tags = card.getAttribute('data-tags').toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm) || tags.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Clear search when search box is empty
        document.getElementById('searchBox').addEventListener('input', function() {
            if (this.value === '') {
                const videoCards = document.querySelectorAll('.video-card');
                videoCards.forEach(card => {
                    card.style.display = 'block';
                });
            }
        });

        // Dynamic video loading from manifest
        async function loadVideosFromCMS() {
            let videoFiles = [];
            try {
                const listRes = await fetch('videos/list.json', { cache: 'no-store' });
                if (listRes.ok) {
                    const data = await listRes.json();
                    if (Array.isArray(data)) {
                        videoFiles = data;
                    } else if (data && Array.isArray(data.videos)) {
                        videoFiles = data.videos.map(item => typeof item === 'string' ? item : item.path).filter(Boolean);
                    }
                }
            } catch (e) {
                console.warn('videos/list.json not found, using fallback list.');
            }

            if (!videoFiles || videoFiles.length === 0) {
                videoFiles = [
                    'videos/first-video.html',
                    'videos/second-video.html', 
                    'videos/third-video.html',
                    'videos/fourth-video.html',
                    'videos/fifth-video.html'
                ];
            }

            const videoGrid = document.getElementById('videoGrid');
            videoGrid.innerHTML = '';

            let loadedCount = 0;
            for (const videoFile of videoFiles) {
                try {
                    const response = await fetch(videoFile, { cache: 'no-store' });
                    if (response.ok) {
                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const title = doc.querySelector('h1')?.textContent || 'Untitled Video';
                        const description = doc.querySelector('.meta')?.textContent || '';
                        const iframeSrc = doc.querySelector('iframe')?.src || '';

                        const videoCard = document.createElement('div');
                        videoCard.className = 'video-card';
                        videoCard.setAttribute('data-title', title);
                        videoCard.setAttribute('data-description', description);
                        videoCard.setAttribute('data-tags', title.toLowerCase());
                        videoCard.innerHTML = `
                            <a href="${videoFile}">
                                <div class="thumb-container">
                                    <img src="${iframeSrc}" alt="${title}" onerror="this.src='https://via.placeholder.com/300x200/111/fff?text=Video'">
                                </div>
                                <div class="card-content">
                                    <h2>${title}</h2>
                                    <p>${description}</p>
                                </div>
                            </a>
                        `;
                        videoGrid.appendChild(videoCard);
                        loadedCount++;
                    }
                } catch (err) {
                    console.log('Skip invalid video file', videoFile, err);
                }
            }

            if (loadedCount === 0) {
                videoGrid.innerHTML = '<div class="error">No videos found yet. Add one in Admin (Manifests â†’ Video List), then refresh.</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadVideosFromCMS);
  </script>
</body>
</html>
